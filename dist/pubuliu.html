<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>瀑布流</title>
    <link rel="stylesheet" href="css/pubuliu.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- top -->
    <div id="topNav">
        <div id="topNavIndex">
            <div class="left">
                <span>
                    考拉欢迎你！
                </span>
                <a href="#">登录</a>
                <a href="#">免费注册</a>
            </div>
            <div class="left2">
                <a href="#">手机考拉
                    <span class="app">
                        <img src="https://haitao.nos.netease.com/9c6b0d6c-4a71-4018-8fb6-46496f51caff.png" alt="">
                        <p>
                            下载APP<br>
                            领1000元新人礼包
                        </p>
                    </span>
                </a>
            </div>
            <div class="right">
                <ul>
                    <li class="sign"><a href="#">每日签到</a></li>
                    <li class="order"><a href="#">我的订单</a></li>
                    <li class="selef">
                        <a href="#">
                            个人中心
                            <div class="selefmore">
                                <a href="#">我的优惠券</a>
                                <a href="#">我的红包</a>
                                <a href="#">我的考拉豆</a>
                                <i></i>
                                <a href="#">账号管理</a>
                                <a href="#">我的实名认证</a>
                                <a href="#">我收藏的商品</a>
                                <a href="#">我关注的品牌</a>
                                <a href="#">售后管理</a>
                            </div>
                        </a>
                    </li>
                    <li class="service">
                        <a href="#">
                            客户服务
                            <div class="service-more">
                                <a class="ser" href="#">
                                    <em></em> 
                                    联系客服
                                </a>
                                <a class="help" href="#">
                                    <em></em> 
                                    帮助中心
                                </a>
                            </div>
                        </a>
                    </li>
                    <li class="top-up">
                        <a href="#">
                            充值中心
                            <div class="top-more">
                                <a href="#">话费流量</a>
                                <a href="#">游戏充值</a>
                                <a href="#">AppStore充值码</a>
                            </div>
                        </a>
                    </li>
                    <li class="interests">
                        <a href="#">
                            消费者权益
                            <div class="interests-more">
                                <a href="#">消费者告知书</a>
                                <a href="#">消费投诉公示</a>
                            </div>
                        </a>
                    </li>
                    <li class="more">
                        <a href="#">
                            更多
                            <div class="mores">
                                <a href="#">收藏本站</a>
                                <a href="#">新浪微博</a>
                                <a href="#">微信公众号</a>
                                <a href="#">易信公众号</a>
                                <a href="#">招商合作</a>
                                <a href="#">考拉招聘</a>
                            </div>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <!-- header -->
    <header>
        <div class="header-top">
            <div class="logo-img">
                
            </div>
            <!-- 搜索 -->
            <div id="search">
                <div class="wrap">
                    <input type="text" placeholder="欧舒丹护手霜">
                </div> 
                <span class="but-box">
                    <span class="but">

                    </span>
                </span> 
                <span class="phone">

                </span>  
                <ul class="ep">
                    <li>
                        <a href="#">面膜</a>
                        
                    </li>
                    <li>
                        <a href="#">口红</a>
                        
                    </li>
                    <li>
                        <a href="#">减肥</a>
                        
                    </li>
                    <li>
                        <a class="internal" href="#">全球工厂店</a>
                        
                    </li>
                    <li>
                        <a href="#">运动鞋</a>
                        
                    </li>
                    <li>
                        <a href="#">项链</a>
                        
                    </li>
                    <li>
                        <a href="#">女包</a>
                        
                    </li>
                </ul>
                
            </div>
            <div id="shopcar">
                <a href="#">
                    <span class="img">

                    </span>
                    <span class="int">
                        购物车
                    </span>
                    <!-- <span class="num">
                        
                    </span>
                    <ul class="goods-list">
                         <li>
                            <img src="" alt="">
                            <h5>
                                我是
                            </h5>
                            <strong>10</strong>
                        </li> 
                    </ul> -->
                </a>
            </div>
        </div> 
        <div id="nav">
            <div id="nav-con">
                <div class="level-top">
                    <div class="icon">
                        <i></i>
                        <i></i>
                        <i></i>
                    </div>
                    <span class="all">所有分类 
                    <ul class="level-item">
                        <li>
                            <img src="http://haitao.nos.netease.com/1cet9lmhg85_40_40.png?imageView&thumbnail=20x20&quality=100" alt="" class="icon">
                            <span>母婴儿童</span>
                            <i></i>
                        </li>
                        <li>
                            <img src="//haitao.nos.netease.com/1cet9magj32_40_40.png?imageView&thumbnail=20x20&quality=100" alt="" class="icon">
                            <span>美容彩妆</span>
                        </li>
                        <li>
                            <img src="//haitao.nos.netease.com/1cet9mvrc65_40_40.png?imageView&thumbnail=20x20&quality=100" alt="" class="icon">
                            <span>轻奢</span>
                        </li>
                        <li>
                            <img src="//haitao.nos.netease.com/1cet9n9g361_40_40.png?imageView&thumbnail=20x20&quality=100" alt="" class="icon">
                            <span>家居个护</span>
                        </li>
                        <li>
                            <img src="//haitao.nos.netease.com/1cet9no5t81_40_40.png?imageView&thumbnail=20x20&quality=100" alt="" class="icon">
                            <span>营养保健</span>
                        </li>
                        <li>
                            <img src="//haitao.nos.netease.com/1cet9o36p76_40_40.png?imageView&thumbnail=20x20&quality=100" alt="" class="icon">
                            <span>手表配饰</span>
                        </li>
                        <li>
                            <img src="//haitao.nos.netease.com/1cet9ogop45_40_40.png?imageView&thumbnail=20x20&quality=100" alt="" class="icon">
                            <span>数码家电</span>
                        </li>
                        <li>
                            <img src="//haitao.nos.netease.com/1cet9or5050_40_40.png?imageView&thumbnail=20x20&quality=100" alt="" class="icon">
                            <span>环球美食</span>
                        </li>
                        <li>
                            <img src="//haitao.nos.netease.com/1cet9p5fv45_40_40.png?imageView&thumbnail=20x20&quality=100" alt="" class="icon">
                            <span>运动户外</span>
                        </li>
                        <li>
                            <img src="//haitao.nos.netease.com/1cet9peo633_40_40.png?imageView&thumbnail=20x20&quality=100" alt="" class="icon">
                            <span>服饰鞋靴</span>
                        </li>
                    </ul>
                </span>
                </div>
                <ul class="nav-item" class="clearfix">
                    <li>
                        <a href="#">首页</a>
                        
                    </li>
                    <li>
                        <a href="#">今日限购</a>
                        
                    </li>
                    <li>
                        <a href="#">每日上新</a>
                        
                    </li>
                    <li>
                        <a href="#">国家馆</a>
                        
                    </li>
                    <li>
                        <a href="#">海外旗舰店</a>
                        
                    </li>
                    <li>
                        <a href="#">工厂店</a>
                        
                    </li>
                    <li>
                        <a href="#">品质奶粉</a>
                        
                    </li>
                    <li>
                        <a href="#">人气面膜</a>
                        
                    </li>
                    <li>
                        <a href="#">充值</a>
                        
                    </li>
                </ul>
            </div>
        </div> 
    </header>
    <div class="content">
        <div class="top">
            
        </div>
        <div class="inner">
            <ul> 
                
            </ul>
        </div>
    </div>












    <script src="pubuliu.js"></script>
    <!-- <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="jquery.cookie.js"></script>

    <script>
            function ShopCar(){
    
            }
            $.extend(ShopCar.prototype,{
                init:function(){
                    this.main =$("#shopcar ul")
                    this.loadJson()
                    .then(function(res){
                        this.json=res.subjects;
                        this.renderPage()
                    })
                    this.bindEvent();
                    this.listSum();
    
                },
                loadJson:function(){
                    var opt={
                        url:"php/data.json",
                        data:{start:0,count:10},
                        type:"GET",
                        context:this
    
                    }
                    return $.ajax(opt);
                },
                renderPage:function(){
                    console.log(this.json)
                    var html="";
                    for(var i=0 ;i<this.json.length;i++){
                        html+=` <li>
                                    <div class="img">
                                        <img src="${this.json[i].images.small.replace(/\.jpg/g,".webp")}" alt="">
                                        <div class="tejia">
                                            <div class="tag">
                                                    满199减40 | 特价
                                            </div>
                                        </div>
                                    </div>
                                    <h5>
                                        <a href="#">${this.json[i].title}</a> 
                                    </h5>
                                    <h6>
                                            “妈妈之选”大赏得主
                                    </h6>
                                    <div class="price">
                                        <span class="money">
                                            <i>包邮价
                                                &nbsp;￥
                                            </i>
                                            79
                                        </span>
                                    </div>
                                    <a href="#" class="btn" data-id=${this.json[i].id}>立即购买</a>
                                </li>`
                    }
                    this.main.html(html);
    
                },
                bindEvent:function(){
                    $("#shopcar ul").on("click",".btn",this.addCar.bind(this));
                    $("#shopCar>div").on("mouseenter",this.showList.bind(this));
                    $("#shopCar>div").on("mouseleave",function(){
                        $(".goods-list").children().remove();
                    });
                    $("#shopCar>div").on("click",function(event){
                        var target = event.target ; 
                        if(target != $(".shopCar>div")[0]) return 0;
    
                        $.removeCookie("shopCar");
                        // 执行鼠标移出事件;
                        $("#shopCar>div").triggerHandler("mouseleave");
                        this.listSum();
                    }.bind(this));
                },
                addCar:function(event){
                    var target = event.target ;
                    var goodsId = $(target).attr("data-id");
                    var cookie;
                    if((cookie = $.cookie("shopCar"))){
                        // 将字符串转换为数组, 方便插入操作;
                        // console.log(cookie);
                        var cookieArray = JSON.parse(cookie);
                        // 判定当前要添加的商品 是否已经存在在购物车里;
                        // 表示是否存在商品;
                        var hasGoods = false;
                        for(var i = 0 ; i < cookieArray.length ; i ++){
                            if(cookieArray[i].id == goodsId ) {
                                // 存在 商品;
                                hasGoods = true;
                                cookieArray[i].num ++;
                                break;
                            }
                        }
                        // 如果没有商品;
                        if(hasGoods == false){
                            var goods = {
                                id : goodsId,
                                num : "1"
                            }
                            cookieArray.push(goods);
                        }
    
                        // 将数组 转为字符串 方便 储存cookie;
    
                        // console.log(JSON.stringify(cookieArray));
                        $.cookie("shopCar",JSON.stringify(cookieArray));
                    }else{
                        $.cookie("shopCar",`[{"id":"${goodsId}","num":"1"}]`);
                    }
                    console.log($.cookie("shopCar"));
                    this.listSum();
                },
                showList:function(event){
                    // 判定是否存在购物车,如果不存在购物车就没必要拼接列表了;
                    var target = event.target;
    
                    if(target != $("#shopCar>div")[0]) return 0;
    
                    var cookie;
                    if(!(cookie = $.cookie("shopCar"))){ return 0; };
                    var cookieArray = JSON.parse(cookie);
    
                    var html = "";
                    // for 购物车里有多少商品就拼接多少个;
                    for(var i = 0 ; i < cookieArray.length ; i ++){
                        // console.log(cookieArray[i]);
                        // for 判断哪一个商品是购物车里的商品;
                        for(var j = 0 ; j < this.json.length ; j ++){
                            if(cookieArray[i].id == this.json[j].id){
                                html += `<li data-id="${cookieArray[i].id}">
                                            <img src="${this.json[j].images.small}" alt="">
                                            <h5>${this.json[j].title}</h5>
                                            <strong>${cookieArray[i].num}</strong>
                                        </li>`;
                                break;
                            }
                        }
                    }
                    
                    $(".goods-list").html(html);
                },
                listSum:function(){
                    var cookie;
                    if(!(cookie = $.cookie("shopCar"))){ 
                        $("#shopCar").find("span").html(0);
                        return 0;
                    };
                    var cookieArray = JSON.parse(cookie);
                    var sum = 0;
                    for(var i = 0 ; i < cookieArray.length ; i ++){
                        sum += Number(cookieArray[i].num);
                    }
                    $("#shopCar").find("span").html(sum);
                }
            })
                    var car = new ShopCar();
                    car.init();
        
        
        </script> -->
</body>
</html>